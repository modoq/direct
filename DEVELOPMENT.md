# Development Notes

## Package Structure

```
direct/
├── DESCRIPTION           # Package metadata
├── NAMESPACE            # Exported functions
├── LICENSE              # MIT License
├── README.md            # User documentation
├── .Rbuildignore        # Files to exclude from package build
├── .gitignore           # Git ignore patterns
├── R/
│   ├── tools.R          # Core MCP tools (run_r_code, write_r_script, etc.)
│   ├── setup.R          # Setup functions (init_project, show_claude_config)
│   └── zzz.R            # Package initialization hooks
├── inst/
│   ├── templates/
│   │   └── .Rprofile    # Template for project initialization
│   └── claude_config.json  # Example MCP configuration
└── man/                 # Documentation (generated by roxygen2)
```

## Building the Package

### Generate Documentation

```r
# Install roxygen2 if needed
install.packages("roxygen2")

# Generate documentation from roxygen comments
roxygen2::roxygenise()
```

### Install Locally

```r
# Install from local directory
devtools::install()

# Or with document generation
devtools::install(build_vignettes = FALSE)
```

### Build Package

```r
# Build source package
devtools::build()

# Check package
devtools::check()
```

## Testing

```r
# Load package for testing
devtools::load_all()

# Test functions
init_project()
show_claude_config()
check_setup()
```

## Publishing to GitHub

```bash
cd ~/Desktop/direct
git init
git add .
git commit -m "Initial commit: direct package v0.1.0"
git branch -M main
git remote add origin https://github.com/modoq/direct.git
git push -u origin main
```

## Security Considerations

The package implements multiple security layers:

1. **Path Validation** (`is_safe_path()`)
   - Checks for path traversal patterns before normalization
   - Validates paths are within workspace
   - Blocks `../` and `/..` patterns

2. **Command Filtering**
   - Blocks dangerous R functions: `system()`, `file.remove()`, etc.
   - Prevents environment manipulation: `Sys.setenv()`, `setwd()`
   - Protects against code injection via `source()`

3. **File Protection**
   - No overwriting of existing files
   - All writes restricted to workspace
   - Read-only operations for data viewing

## MCP Tool Integration

Tools are registered in `R/zzz.R` using the `ellmer::tool()` framework:

- Each function is wrapped with MCP metadata
- Tools are stored in package namespace as `mcp_tools`
- `mcptools::mcp_session()` exposes tools to Claude Desktop

## Future Enhancements

- [ ] Add support for parallel MCP sessions
- [ ] Enhanced file editing (append mode)
- [ ] Git integration tools
- [ ] Package installation tools (with safety checks)
- [ ] Environment management (renv integration)
- [ ] Improved error handling and logging

## Dependencies

- **ellmer**: Tool definition framework
- **rstudioapi**: RStudio integration
- **mcptools**: MCP server functionality

## Notes

- All functions maintain backward compatibility with original `direct.R`
- Security features are non-negotiable and cannot be disabled
- Package designed for single-user, single-project workflows
- Multi-project support via multiple MCP server entries in Claude config
